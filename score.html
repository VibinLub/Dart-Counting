<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dart-Counting.com</title>
    <script src="https://kit.fontawesome.com/033f10984a.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1><a href="index.html" style="color: inherit; text-decoration: none;">🎯 Dart-Counting.com 🎯</a></h1>
    </header>

    <section id="game-section">
        <div id="player-info">
            <div id="player1" class="player">
                <h2>🧑‍🎯 <span id="player1-name">Player 1</span></h2>
                <h1>Score: <span id="score1">501</span></h1>
                <p>Sets: <span id="sets1">0</span> | Legs: <span id="legs1">0</span></p>
            </div>
            <div id="player2" class="player">
                <h2>🧑‍🎯 <span id="player2-name">Player 2</span></h2>
                <h1>Score: <span id="score2">501</span></h1>
                <p>Sets: <span id="sets2">0</span> | Legs: <span id="legs2">0</span></p>
            </div>
        </div>

        <div id="input-section">
            <h3>🎯 Enter a score</h3>
            <input type="number" id="score-input" placeholder="Score (0-180)" min="0" max="180">
            <button id="submit-score">✅ Publish Score</button>
        </div>
    </section>

    <footer>
        <p>&copy; 2024 Lubbert Schenk</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const player1NameEl = document.querySelector('#player1-name');
            const player2NameEl = document.querySelector('#player2-name');
            const player1ScoreEl = document.querySelector('#score1');
            const player2ScoreEl = document.querySelector('#score2');
            const sets1El = document.querySelector('#sets1');
            const sets2El = document.querySelector('#sets2');
            const legs1El = document.querySelector('#legs1');
            const legs2El = document.querySelector('#legs2');
            const scoreInput = document.querySelector('#score-input');
            const submitScoreButton = document.querySelector('#submit-score');

            // Haal gegevens van index.html via localStorage
            const player1Name = localStorage.getItem('player1Name') || 'Speler 1';
            const player2Name = localStorage.getItem('player2Name') || 'Speler 2';
            const startScore = parseInt(localStorage.getItem('startScore') || '501', 10);

            // Zet namen en startscores
            player1NameEl.textContent = player1Name;
            player2NameEl.textContent = player2Name;
            player1ScoreEl.textContent = startScore;
            player2ScoreEl.textContent = startScore;

            // Variabelen
            let player1Score = startScore;
            let player2Score = startScore;
            let player1Legs = 0, player2Legs = 0;
            let player1Sets = 0, player2Sets = 0;
            let currentPlayer = 1;

            const updateActivePlayer = () => {
                document.querySelector('#player1').style.backgroundColor = currentPlayer === 1 ? '#f00' : '#222';
                document.querySelector('#player2').style.backgroundColor = currentPlayer === 2 ? '#f00' : '#222';
            };

            const updateScores = (score) => {
                if (currentPlayer === 1) {
                    if (player1Score - score < 0) {
                        alert('Speler 1 heeft te veel gescoord!');
                        return;
                    }
                    player1Score -= score;
                    player1ScoreEl.textContent = player1Score;
                    if (player1Score <= 0) handleLegWin(1);
                } else {
                    if (player2Score - score < 0) {
                        alert('Speler 2 heeft te veel gescoord!');
                        return;
                    }
                    player2Score -= score;
                    player2ScoreEl.textContent = player2Score;
                    if (player2Score <= 0) handleLegWin(2);
                }
                currentPlayer = currentPlayer === 1 ? 2 : 1;
                updateActivePlayer();
            };

            const handleLegWin = (winner) => {
                if (winner === 1) player1Legs++; else player2Legs++;
                legs1El.textContent = player1Legs;
                legs2El.textContent = player2Legs;

                if (player1Legs >= 3 || player2Legs >= 3) handleSetWin(winner);
                resetLeg();
            };

            const handleSetWin = (winner) => {
                if (winner === 1) player1Sets++; else player2Sets++;
                sets1El.textContent = player1Sets;
                sets2El.textContent = player2Sets;

                if (player1Sets === 3) announceWinner(1);
                if (player2Sets === 3) announceWinner(2);
            };

            const resetLeg = () => {
                player1Score = startScore;
                player2Score = startScore;
                player1ScoreEl.textContent = player1Score;
                player2ScoreEl.textContent = player2Score;
            };

            const announceWinner = (winner) => {
                alert(`${winner === 1 ? player1Name : player2Name} heeft gewonnen! 🎉`);
                resetGame();
            };

            const resetGame = () => {
                player1Score = startScore;
                player2Score = startScore;
                player1Legs = 0; player2Legs = 0;
                player1Sets = 0; player2Sets = 0;
                player1ScoreEl.textContent = player1Score;
                player2ScoreEl.textContent = player2Score;
                legs1El.textContent = player1Legs;
                legs2El.textContent = player2Legs;
                sets1El.textContent = player1Sets;
                sets2El.textContent = player2Sets;
                currentPlayer = 1;
                updateActivePlayer();
            };

            scoreInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    submitScoreButton.click();
                    scoreInput.focus(); // Zorg ervoor dat het invoerveld actief blijft
                }
            });

            submitScoreButton.addEventListener('click', () => {
                const score = parseInt(scoreInput.value, 10);
                if (isNaN(score) || score < 0 || score > 180) {
                    alert('Voer een geldige score in (0-180).');
                    return;
                }
                updateScores(score);
                scoreInput.value = '';
            });

            updateActivePlayer();
        });
    </script>
</body>
</html>
